{
  "url": "https://api.github.com/gists/9382a0ae7967eef62acf20f0f31a8c31",
  "forks_url": "https://api.github.com/gists/9382a0ae7967eef62acf20f0f31a8c31/forks",
  "commits_url": "https://api.github.com/gists/9382a0ae7967eef62acf20f0f31a8c31/commits",
  "id": "9382a0ae7967eef62acf20f0f31a8c31",
  "node_id": "G_kwDOBcuSaNoAIDkzODJhMGFlNzk2N2VlZjYyYWNmMjBmMGYzMWE4YzMx",
  "git_pull_url": "https://gist.github.com/9382a0ae7967eef62acf20f0f31a8c31.git",
  "git_push_url": "https://gist.github.com/9382a0ae7967eef62acf20f0f31a8c31.git",
  "html_url": "https://gist.github.com/9382a0ae7967eef62acf20f0f31a8c31",
  "files": {
    "code.js": {
      "filename": "code.js",
      "type": "application/javascript",
      "language": "JavaScript",
      "raw_url": "https://gist.githubusercontent.com/jade-addin/9382a0ae7967eef62acf20f0f31a8c31/raw/1364ff049de052a031ed692810a45ebc8b43f375/code.js",
      "size": 34048,
      "truncated": false,
      "content": "//logistic regression in excel using javascript\n\nlet predictor_names\nlet select_values\n//const form_data={}// takes the place of the from where users entered data on original webpage\nlet model_results={}\nasync function auto_exec(){\n  // set the tool css\n  Jade.set_css(gist_files('style.css'),\"naive-bayes\")\n  // place the tool html \n  tag(\"tools-body\").innerHTML=gist_files('logistic-regression.html')\n  \n  // fill in values from last tool use\n  const tool_data = await jade.read_object_from_workbook(window.active_tool)\n  if(tool_data.outcome_values){\n    select_values = tool_data.outcome_values\n  }\n\n //console.log(\"select_values\",select_values)\n\n  for(const[key,value] of Object.entries(tool_data)){\n    if(tag(key)){\n      tag(key).value=value\n    }\n  }\n\n  // read the last run if there is one\n  model_results = await jade.read_object_from_workbook(window.active_tool+\"_model_result\")\n //console.log(\"model_results\",model_results)\n\n}\n\n\n\nfunction save_inputs(){\n  const values_to_save=get_form_values([\"training-percent\",\"predictors\",\"datasheet\",\"datarange\",\"outcome\",\"predictionsheet\",\"predictionrange\"])\n  jade.save_object_to_workbook(\n    values_to_save     \n    , window.active_tool)\n}\n\nfunction reset_model(){\n  console.log(\"at reset model\")\n  tag(\"predictor-names\").innerHTML=\"\"\n}\nfunction new_data_sheet(){\n  tag(\"datarange\").value=\"\"\n  tag(\"predictors\").value=\"\"\n  tag(\"outcome\").value=\"\"\n  tag(\"predictor-names\").innerHTML=\"\"\n  \n}\nfunction new_data_range(){\n   tag(\"predictors\").value=\"\"\n   tag(\"outcome\").value=\"\"\n   tag(\"predictor-names\").innerHTML=\"\"\n  }\n\n\nasync function split_data(){\n  // save the defaults for the tool\n  save_inputs()\n\n  Excel.run(async function(excel){\n    const sheet = excel.workbook.worksheets.getItem(tag(\"datasheet\").value)\n    let datarange = sheet.getRange(tag(\"datarange\").value)\n    let train_label = datarange.getColumnsAfter(1).getRow(0)\n    const data_labels = datarange.getRow(0)\n    train_label.load(\"values\")\n    data_labels.load(\"values\")\n    try{\n      await excel.sync()\n     //console.log(\"train_label\",train_label.values)\n    }catch(e){\n      alert(`Unable to find the data on a sheet named \"${tag(\"datasheet\").value}\" in a range with an address of \"${tag(\"datarange\").value}\".`)\n      return\n    }\n\n    // checking to see that all columns have labels\n    for(const label of data_labels.values[0]){\n      if(!label){\n        alert('Your data must include a single header row and all cells in the header must have a value.')\n        return\n      }\n    }\n\n    if(train_label.values[0][0]===\"Train\" || data_labels.values[0][data_labels.values[0].length-1]===\"Train\"){\n      alert('This dataset has already been split.  To split it again, delete the column labeled \"Train\" to the right of your data')\n      return\n    }\n\n    let pct=0\n    try{\n      pct=parseFloat(tag(\"training-percent\").value)\n      if(pct < 1 || pct > 100){\n        alert(`Traing Set % must be a number between 1 and 100.`)\n        return\n        }\n    }catch(e){\n     //console.log(\"E\", e)\n      alert(`Could not understand the Training Set %.  You entered ${tag(\"training-percent\").value}.  Expecting a number between 1 and 100.`)\n      return\n    }\n\n\n\n    datarange.getColumnsAfter(1).insert(Excel.InsertShiftDirection.right);\n    const next_col = datarange.getColumnsAfter(1)\n    next_col.load(\"values\")\n    const new_data=[[\"Train\"]]\n\n    await excel.sync()\n\n    const rows=[]\n\n    for(let x=1;x<next_col.values.length;x++){\n      rows.push({index:x,rnd:Math.random()})\n      new_data.push([true])\n    }\n    rows.sort((a, b) => (a.rnd > b.rnd) ? 1 : -1)\n\n    let test_ct=Math.round(((100 - pct)/100)*rows.length)\n    if(test_ct < 1){\n      test_ct=1\n    }\n\n    // randomly assing test/train\n    for(let x=0;x<test_ct;x++){\n      new_data[rows[x].index][0]=false\n    }\n    next_col.values=new_data\n    await excel.sync()\n  })\n}\n\n\n\nfunction get_form_values(tag_names){\n  const obj={}\n  for(const tag_name of tag_names){\n    obj[tag_name]=tag(tag_name).value\n  }\n  return obj\n}\n\n\nfunction configure_example(){\n  tag(\"predictor-names\").innerHTML=\"\"\n  Excel.run(async function(excel){\n    const sheetname=\"Example Data\"\n    let sheet = excel.workbook.worksheets.getItemOrNullObject(sheetname); \n    await excel.sync()\n    if (sheet.isNullObject) {\n      // sheet does not yet exist, create it\n      sheet=excel.workbook.worksheets.add(sheetname)\n    }else{\n      sheet.getUsedRange().delete()\n    }\n    sheet.activate()\n    await jade_modules.jet_engine.stream_to_range(\"https://jade-addin.github.io/data/phone_data.data\",sheet)\n    await jade_modules.jet_engine.stream_to_range(\"https://jade-addin.github.io/data/phone_data-prediction.data\",sheet,0,8)\n    \n\n    //sheet.getRange(\"A1:D41\").values = jade_modules.jet_engine.table_stream_to_excel_array(\"1\u001F1\u001F1\u001F1\u001EDonate\u001FMember\u001FIncome\u001FAge\u001E0\u001F3\u001F83.4\u001F53\u001E0\u001F1\u001F84.3\u001F53\u001E0\u001F1\u001F87.2\u001F50\u001E0\u001F1\u001F86.6\u001F52\u001E0\u001F1\u001F92\u001F45\u001E0\u001F1\u001F90.4\u001F50\u001E1\u001F1\u001F138.3\u001F51\u001E1\u001F2\u001F140.8\u001F46\u001E0\u001F1\u001F90.5\u001F54\u001E0\u001F2\u001F66.6\u001F55\u001E0\u001F1\u001F91.2\u001F55\u001E0\u001F1\u001F95.7\u001F58\u001E1\u001F2\u001F76.3\u001F52\u001E0\u001F1\u001F103.2\u001F57\u001E1\u001F1\u001F102.6\u001F58\u001E0\u001F1\u001F104\u001F56\u001E0\u001F2\u001F91.3\u001F47\u001E0\u001F2\u001F84.5\u001F57\u001E0\u001F1\u001F111.5\u001F56\u001E0\u001F1\u001F110.7\u001F59\u001E1\u001F2\u001F89.7\u001F60\u001E0\u001F2\u001F97.5\u001F54\u001E0\u001F2\u001F98.2\u001F56\u001E1\u001F1\u001F124.5\u001F54\u001E1\u001F2\u001F99.5\u001F58\u001E1\u001F1\u001F122.2\u001F62\u001E1\u001F2\u001F106.2\u001F50\u001E1\u001F2\u001F110.6\u001F57\u001E0\u001F2\u001F109.8\u001F59\u001E1\u001F2\u001F113.9\u001F54\u001E1\u001F2\u001F113.3\u001F61\u001E1\u001F2\u001F124.5\u001F56\u001E0\u001F1\u001F133.8\u001F49\u001E1\u001F2\u001F142.4\u001F44\u001E0\u001F1\u001F89.4\u001F52\u001E0\u001F1\u001F87.3\u001F58\u001E0\u001F1\u001F84.6\u001F48\u001E1\u001F2\u001F124.9\u001F58\u001E0\u001F1\u001F84.4\u001F47\u001E1\u001F2\u001F119.4\u001F50\").values\n    //sheet.getRange(\"F1:H5\").values = jade_modules.jet_engine.table_stream_to_excel_array(\"1\u001F1\u001F1\u001EMember\u001FIncome\u001FAge\u001E3\u001F83.4\u001F56\u001E1\u001F140.3\u001F42\u001E1\u001F122.2\u001F42\u001E1\u001F106.6\u001F25\").values\n    await excel.sync()\n    tag(\"datasheet\").value=\"Example Data\"\n    tag(\"datarange\").value=\"A1:F1001\"\n    tag(\"outcome\").value=\"A1:A1001\"\n    tag(\"predictors\").value=\"B1:F1001\"\n    tag(\"predictionsheet\").value=\"Example Data\"\n    tag(\"predictionrange\").value=\"J1:N101\"\n\n  })\n}\n\n\nasync function get_address(tag_name){\n  tag(tag_name).value=await jade_modules.jet_engine.selected_range_address()\n}\n\n\n// must be called from insde an excel block\nfunction format_table(sheet, start_row,start_column,rows,columns,row_headers=0, column_headers=1){\n  if(column_headers){\n    const col_head_range = sheet.getRangeByIndexes(start_row-1,start_column-1,column_headers,columns)\n    jade_modules.jet_engine.range_format(sheet, col_head_range, \"format/fill/color\",  \"Maroon\")\n    jade_modules.jet_engine.range_format(sheet, col_head_range, \"format/font/color\",  \"White\")\n    jade_modules.jet_engine.range_format(sheet, col_head_range, \"format/font/bold\",  true)\n        \n  }\n  if(row_headers){\n    const row_head_range = sheet.getRangeByIndexes(start_row-1+column_headers,start_column-1,rows-column_headers,row_headers)\n    jade_modules.jet_engine.range_format(sheet, row_head_range, \"format/fill/color\",  \"LightGray\")\n  }\n  const table_range = sheet.getRangeByIndexes(start_row-1,start_column-1,rows,columns)\n  jade_modules.jet_engine.border_around(sheet, table_range,\"Medium\",\"Continuous\",\"Black\")\n  \n}\n\nasync function run_model(){\n  // save the defaults for the tool\n //console.log(\"run model\")\n  // if(isNaN(tag(\"training-percent\").value) || parseFloat(tag(\"training-percent\").value)<1 || parseFloat(tag(\"training-percent\").value)>100){\n  //   alert(\"Training Percent must be a number between 1 and 100.\",\"Model Problem\")  \n  //   return\n  // }\n\n  // compare last predictors to these, if changed, need to re-run model\n  const tool_data = await jade.read_object_from_workbook(window.active_tool)\n  if(tool_data.predictors !== tag(\"predictors\").value){\n    console.log(\"--predictors have changed\")\n  }\n\n  if(tool_data.outcome !== tag(\"outcome\").value){\n    console.log(\"--outcome has changed\")\n  }\n\n  if(tool_data.datasheet !== tag(\"datasheet\").value){\n    console.log(\"--datasheet has changed\")\n  }\n\n\n  \n  save_inputs()\n\n\n  Excel.run(async function(excel){\n   //console.log('tag(\"outcome\")',tag(\"outcome\").value)\n    const sheet = excel.workbook.worksheets.getItem(tag(\"datasheet\").value)\n    const outcome = sheet.getRange(tag(\"outcome\").value)\n    const predictors = sheet.getRange(tag(\"predictors\").value)\n    const train = sheet.getRange(tag(\"datarange\").value).getColumnsAfter(1)\n    let sheetname=\"Logistic Regression Results\"\n    predictors.load(\"values\")\n    outcome.load(\"values\")\n    train.load(\"values\")\n    \n    predictor_names=predictors.getRow(0)\n    predictor_names.load(\"values\")\n    let out_sheet = excel.workbook.worksheets.getItemOrNullObject(sheetname); \n\n    try{\n      await excel.sync()\n    }catch(e){\n     //console.log(\"e\",e)\n      alert(\"Unable to initialize model. Check the following:<ul><li>Data Sheet</li><li>Data Range</li><li>Dependent Variable</li><li>Independent Variables</li></ul>\", \"Problem\")\n    }\n    \n    if(predictors.values.length !== outcome.values.length){\n      alert(\"You must have the same number of rows for your predictors as you do for your outcomes.\",\"Problem\")\n      return\n    }\n    if(outcome.values[0].length !== 1){\n      alert(\"Your outcome must be a single column.\",\"Problem\")\n      return\n    }\n\n    // check outcomes for 1 and zero only\n    for(let x=1;x<outcome.values.length;x++){\n      if(outcome.values[x][0]!==1 && outcome.values[x][0]!==0){\n        alert('All all values in the outcome must be 1 or 0.  This analysis stopped when encountering \"' + outcome.values[x][0] + '\".', \"Problem\")\n        return  \n      }\n    }\n\n\n    // check predictors for numeric entries\n    for(let x=1;x<predictors.values.length;x++){\n      for(const cell of predictors.values[x]){\n        if(isNaN(cell)){\n          alert('All all values in the predictor variables must be numeric.  This analysis stopped when encountering \"' + cell + '\".', \"Problem\")\n          return  \n        }\n      }\n\n      if(outcome.values[x][0]!==1 && outcome.values[x][0]!==0){\n      }\n    }\n\n\n    // check for train/test\n    let use_all_data_for_training=false\n    if(tag(\"training-percent\").value===\"100\"){\n      tag(\"training-percent\").value=100\n      use_all_data_for_training=true\n    }else if(train.values[0][0]!==\"Train\"){\n      use_all_data_for_training=true\n      tag(\"training-percent\").value=100\n      alert('Could not find \"Train\" column after data.  Using all data for training.',\"Problem\")\n\n    }\n\n    // figure out which predictors are to be used in the model\n    const predictors_in_model=[]\n    if(!tag(\"predictor-names\").innerHTML){\n      const html=['Include the following:<div id=\"predictors-in-use\" style=\"padding-left:1rem\">']\n\n      for(let x=0;x<predictor_names.values[0].length;x++){\n        const pred = predictor_names.values[0][x]\n        html.push(`<input type=\"checkbox\" checked value=\"${x}\"> ${pred}<br>`)\n        predictors_in_model.push(x)\n      }\n      html.push(\"</div>\")\n      tag(\"predictor-names\").innerHTML=html.join(\"\")\n    }else{\n      for(const elem of tag(\"predictors-in-use\").children){\n        if(elem.tagName===\"INPUT\" && elem.checked){\n          predictors_in_model.push(parseInt(elem.value))\n        }\n      }\n    }  \n\n   \n    \n\n    // build data for analysis\n    const data_for_training=[]\n    const data_for_testing=[]\n    const training_percent = parseFloat(tag(\"training-percent\").value)\n    // const predictors_for_sheet={}\n    // for(let x=0;x<predictors.values[0].length;x++){\n    //   predictors_for_sheet[predictors.values[0][x]]=predictors_in_model.includes(x)\n    // }\n\n\n    for(let x=1;x<predictors.values.length;x++){\n      const row_data=[]\n      for(let p=0;p<predictors_in_model.length;p++){\n        row_data.push(predictors.values[x][predictors_in_model[p]])\n      }\n      row_data.push([outcome.values[x][0]])\n      if(use_all_data_for_training || train.values[x][0]){   \n        data_for_training.push(row_data)\n      }else{\n        data_for_testing.push(row_data)\n      }  \n    }\n\n   //console.log(\"use_all_data_for_training\",use_all_data_for_training)\n   //console.log('data_for_training',data_for_training)\n   //console.log('data_for_testing',data_for_testing)\n    \n\n    //iterate(tag('form'))\n    const model_data={\n      predictor_names:predictor_names.values[0],\n      predictors_in_model:predictors_in_model,\n      train:data_for_training,\n      test:data_for_testing\n    }\n    model_results=logistic_regression(model_data)\n\n    \n    //console.log(form_data.output)\n    console.log(model_results)\n\n\n\n\n    if (out_sheet.isNullObject) {\n      // sheet does not yet exist, create it\n      out_sheet=excel.workbook.worksheets.add(sheetname)\n    }else{\n      out_sheet.getRange(\"1:\"+(10+predictors_in_model.length)).insert(Excel.InsertShiftDirection.down)\n    }\n\n   //console.log(\"predictor_names\",predictor_names.values)\n \n    out_sheet.activate()\n    await excel.sync()\n\n    const model_stats=[]\n    const prediction_formula=['=R3C3']\n    model_stats.push([\"Model Statistics\",null])\n    model_stats.push([\"Y-Intercept\",1])\n    for(let x=0;x<predictors_in_model.length;x++){\n      const m = predictors_in_model[x]\n      model_stats.push([`Beta: ${predictor_names.values[0][m]}`,0])\n      prediction_formula.push(` & \"+(\" & R${4+x}C3 & \"*<<${predictor_names.values[0][m]}>>)\"`)\n    }\n\n\n    out_sheet.getRange(\"G7:H7\").merge(true)\n    out_sheet.getRange(\"B2:C2\").merge(true)\n\n    // out_sheet.getRange(\"B7:B8\").merge(true)\n    // out_sheet.getRange(\"C7:C8\").merge(true)\n    // out_sheet.getRange(\"D7:D8\").merge(true)\n    // out_sheet.getRange(\"E7:E8\").merge(true)\n    // out_sheet.getRange(\"F7:F8\").merge(true)\n      format_table(out_sheet,2,2,4,2,1,1)\n    format_table(out_sheet,7,2,3+predictors_in_model.length,7,1,2)\n\n\n    jade_modules.jet_engine.range_format(out_sheet, \"F9:H9\",\"format/fill/color\",  \"Gray\")\n    jade_modules.jet_engine.range_format(out_sheet, \"B9:H\"+(9+predictors_in_model.length), \"numberFormat\",  \"0.000\")\n    jade_modules.jet_engine.range_format(out_sheet, \"E9:E\"+(9+predictors_in_model.length), \"numberFormat\",  \"0.00000\")\n    jade_modules.jet_engine.range_format(out_sheet, \"C3\", \"numberFormat\",  \"0.000\")\n    jade_modules.jet_engine.range_format(out_sheet, \"C4\", \"numberFormat\",  \"0\")\n    jade_modules.jet_engine.range_format(out_sheet, \"C5\", \"numberFormat\",  \"0.00000\")\n\n    out_sheet.getRange(\"B2:C5\").values=[\n       [\"Overall Model Measures\",null],\n       [\"Chi Square\",model_results.fit.chi_square],\n       [\"df\",model_results.fit.df],\n       [\"p-value\",model_results.fit.p],\n     ]\n\n     let coeff=[\n      [\"Predictor\",\"Co-\",\"Standard\",null,\"Odds\",model_data.confidence + \"% Conf. Int.\",null],\n      [\"Name\",\"efficient\",\"Error\",\"p-value\",\"Ratio\",\"Low\",\"High\"],\n      [\"Intercept\",model_results.intercept.coeff,model_results.intercept.std_err,model_results.intercept.p,null,null,null]\n    ]\n    for(let x=0;x<predictors_in_model.length;x++){\n     //console.log(x,model_results.predictors[x].variable,model_results.predictors[x].odds_ratio)\n      coeff.push([model_results.predictors[x].variable,model_results.predictors[x].coeff,model_results.predictors[x].std_err,model_results.predictors[x].p,model_results.predictors[x].odds_ratio,model_results.predictors[x].conf_low,model_results.predictors[x].conf_high])\n    }\n    const report_coeff={}\n    for(let x=2;x<coeff.length;x++){\n      report_coeff[coeff[x][0]]=coeff[x][1]\n    }\n   //console.log(\"coeff\",coeff)\n\n    out_sheet.getRangeByIndexes(6,1,3+predictors_in_model.length,7).values=coeff\n    out_sheet.getRange(\"B:H\").format.autofitColumns()\n\n\n\n    // disable odds ratio and confidence interval\n    const optional_data = out_sheet.getRangeByIndexes(6,5,3+predictors_in_model.length,3)\n    optional_data.values=null\n    optional_data.format.fill.clear()\n    jade_modules.jet_engine.border_around(sheet, optional_data,\"Medium\",\"Continuous\",\"Black\")\n    optional_data.format.borders.getItem('EdgeBottom').style = \"None\";\n    optional_data.format.borders.getItem('EdgeRight').style = \"None\";\n    optional_data.format.borders.getItem('EdgeTop').style = \"None\";\n\n    // confusion matrix\n\n\n    if(model_results.confusion){\n\n      out_sheet.getRange(\"B5:C5\").format.borders.getItem('EdgeBottom').style = \"None\";  \n\n      const accuracy_range=out_sheet.getRange(\"B6:C6\")\n      accuracy_range.format.borders.getItem('EdgeBottom').style = \"Continuous\";\n      accuracy_range.format.borders.getItem('EdgeLeft').style = \"Continuous\";\n      accuracy_range.format.borders.getItem('EdgeRight').style = \"Continuous\";\n      accuracy_range.format.borders.getItem('EdgeBottom').weight = \"Medium\";\n      accuracy_range.format.borders.getItem('EdgeLeft').weight = \"Medium\";\n      accuracy_range.format.borders.getItem('EdgeRight').weight = \"Medium\";\n      jade_modules.jet_engine.range_format(out_sheet, \"C6\", \"numberFormat\",  \"0.0%\")\n\n      out_sheet.getRange(\"B6:C6\").values=[\n         [\"Accuracy\",\"=(G6+F5)/SUM(F5:G6)\"]\n       ]\n  \n      const confusion_array=model_results.confusion\n      confusion_array[0].unshift(0)\n      confusion_array[1].unshift(1)\n      confusion_array.unshift([\"Actual\",0,1])\n      confusion_array.unshift([null,\"Predicted\",null])\n      confusion_array.unshift([\"Confusion Matrix\",null,null])\n\n      out_sheet.getRange(\"B7:H7\").insert(Excel.InsertShiftDirection.down);\n      const confusion_matrix = out_sheet.getRange(\"E2:G6\")\n      confusion_matrix.values=confusion_array\n      jade_modules.jet_engine.range_format(out_sheet, \"E4:G6\", \"numberFormat\",  \"0\")\n      format_table(out_sheet,2,5,5,3,1,1)\n      out_sheet.getRange(\"E2:G2\").merge(true)\n      out_sheet.getRange(\"F3:G3\").merge(true)\n      jade_modules.jet_engine.range_format(out_sheet, \"F3:G4\",\"format/fill/color\",  \"LightGray\")\n      jade_modules.jet_engine.range_format(out_sheet, \"B6\",\"format/fill/color\",  \"LightGray\")\n      jade_modules.jet_engine.range_format(out_sheet, \"E3:G6\", \"format/horizontalAlignment\",  \"Center\")      \n\n    }\n\n    // header\n    out_sheet.getRange(\"B2:H4\").insert(Excel.InsertShiftDirection.down);\n    out_sheet.getRange(\"B2:G2\").merge(true)\n    jade_modules.jet_engine.range_format(out_sheet, \"B2:G2\",\"format/fill/color\",  \"#000080\")\n    jade_modules.jet_engine.range_format(out_sheet, \"B2:G2\", \"format/font/color\",  \"White\")\n    jade_modules.jet_engine.range_format(out_sheet, \"B2:G2\", \"format/font/bold\",  true)\n    jade_modules.jet_engine.range_format(out_sheet, \"B2:G2\", \"format/horizontalAlignment\",  \"Center\") \n    out_sheet.getRange(\"B2:G2\").values=\"Data: \" + tag(\"datasheet\").value + \" (\"+tag(\"predictors\").value+\")\"\n\n    out_sheet.getRange(\"B3:G3\").merge(true)\n    jade_modules.jet_engine.range_format(out_sheet, \"B3:G3\",\"format/fill/color\",  \"#000080\")\n    jade_modules.jet_engine.range_format(out_sheet, \"B3:G3\", \"format/font/color\",  \"White\")\n    jade_modules.jet_engine.range_format(out_sheet, \"B3:G3\", \"format/font/bold\",  true)\n    jade_modules.jet_engine.range_format(out_sheet, \"B3:G3\", \"format/horizontalAlignment\",  \"Center\") \n    out_sheet.getRange(\"B3:G3\").values=\"Training Percent: \" + tag(\"training-percent\").value + \"%\"\n\n    await save_model_to_sheet(out_sheet, report_coeff, excel)\nawait excel.sync()\n//    out_sheet.getRangeByIndexes(model_stats.length+2,1,1,1).formulasR1C1=prediction_formula.join(\"\")\n      jade.save_object_to_workbook(model_results,window.active_tool+\"_model_result\")\n    })\n\n\n}\n\nasync function save_model_to_sheet(sheet, report_coeff, ctx){\n  const model_names=sheet.names\n  model_names.load(\"items\")\n  await ctx.sync()\n\n  if(model_names.items.length>0){\n    for(let y=model_names.items.length-1; y>=0 ;y--){\n     //console.log(\"deleting model name on sheet\",y)\n      model_names.items[y].delete()\n    }\n  }\n\n  sheet.names.add(\"training_pct\",tag(\"training-percent\").value).visible=false\n  sheet.names.add(\"data_sheet\",tag(\"datasheet\").value).visible=false\n  sheet.names.add(\"dependent_variable\",tag(\"outcome\").value).visible=false\n  sheet.names.add(\"independent_variables\",tag(\"predictors\").value).visible=false\n  sheet.names.add(\"coefficients\",JSON.stringify(report_coeff)).visible=false\n  //console.log('report_coeff',report_coeff)\n}\n\n\nasync function predict(){\n  // save the defaults for the tool\n  save_inputs()\n  //console.log(\"probabilities\", probabilities)\n  if(Object.keys(model_results).length===0){\n      alert(\"Could not find a model.  Have you completed step 1?\",\"Problem\")\n      return\n  }\n  const variables=[]\n  for(const pred of model_results.predictors){\n    variables.push({name:pred.variable,position:null,coeff:pred.coeff})\n  }\n\n  Excel.run(async function(excel){\n    const sheet = excel.workbook.worksheets.getItem(tag(\"predictionsheet\").value)\n    const datarange = sheet.getRange(tag(\"predictionrange\").value)\n    const data_names=datarange.getRow(0)\n    data_names.load('values,columnIndex')\n    sheet.activate()\n    await excel.sync()\n\n    // check to see if we can find all the vairables\n    const missing_variables=[]\n    for(const variable of variables){\n      if(data_names.values[0].includes(variable.name)){\n        variable.position=data_names.values[0].indexOf(variable.name)\n      }else{  \n        missing_variables.push(variable.name)\n      }\n    }\n    if(missing_variables.length>0){\n      alert(`In the data you are using for prediction, you must have a column named for each of the predictors in the model.  Could not find the following:<br><ul><li>${missing_variables.join(\"</li><li>\")}</li></ul>`, \"Problem\")\n      return\n    }\n   //console.log(\"variables\",variables)\n\n\n    datarange.getColumnsAfter(4).insert(Excel.InsertShiftDirection.right);\n    const next_col = datarange.getColumnsAfter(3)\n    next_col.load('values,columnIndex')\n    datarange.load(\"values\")\n    await excel.sync()\n\n    const start_col=data_names.columnIndex\n    const target_col=next_col.columnIndex\n    const col_count = data_names.values[0].length\n\n   //console.log(\"start_col\",start_col)\n   //console.log(\"target_col\",target_col)\n    const tool_data = await jade.read_object_from_workbook(window.active_tool)\n\n   //console.log(\"tool_data\",tool_data)\n    const prediction_formula=[`=exp(${model_results.intercept.coeff}`]\n    const label=[`=IF(TRUE,\"Prediction\",\"Data: ${tool_data.datasheet} (${tool_data.predictors}); Training %: ${tool_data[\"training-percent\"]}; Predictors: `]\n    const vars=[]\n    for(const v of variables){\n      vars.push(v.name)\n      prediction_formula.push(`+(${v.coeff}*RC[${0-col_count+v.position}])`)\n    }\n    label.push(vars.join(\", \"))\n    label.push('\")')\n    prediction_formula.push(\")\")\n\n    const prediction=[[\"Odds\",\"Probability\",label.join(\"\")]]\n    for(let x=1;x<next_col.values.length;x++){\n      prediction.push([prediction_formula.join(\"\"),\"=RC[-1]/(RC[-1]+1)\",\"=if(RC[-1]>.5,1,0)\"])\n    }\n    next_col.formulasR1C1=prediction\n    await excel.sync()\n  })\n}\n     /////////////////////////////////////////////////////////////////\n    //                                                             //\n   //  code imported from https://statpages.info/logistic.html    //\n  //     This code has been modified to work with JADE Tools     //\n //                                                             //\n/////////////////////////////////////////////////////////////////\nfunction logistic_regression(model_data){\n  // model_data is an object with two keys: test and train\n  // test and train are arrays of arrays where the last value\n  // is the outcome and all preeceeding values are predictors\n  const model_results={}\n  let CR = \"\\r\";\n  let LF = \"\\n\";\n  let Tb = \"\\t\";\n  let NL = CR + LF;\n  var Pi = 3.141592653589793;\n  var PiD2 = Pi/2;\n\n  const train_data=[]\n  if(model_data.confidence===undefined){\n    model_data.confidence=95\n  }\n\n  for(const row of model_data.train){\n    train_data.push(row.join(\",\"))\n  }\n\n  const form_data={\n    predictor_names:model_data.predictor_names,\n    predictors_in_model:model_data.predictors_in_model,\n    data:train_data.join(\"\\n\"),\n    cPts:train_data.length,\n    cVar:model_data.train[0].length-1\n  }\n  console.log(\"model_data\",model_data)\n\n  iterate()// this actually runs the regressions\n\n  // now calculate confusion if needed\n  if(model_data.test && model_data.test.length>0){\n    const confusion_array=[[0,0],[0,0]]\n    // some of the data is for testing the model, so run the test\n    for(let z=0;z<model_data.test.length;z++){\n      const test_row = model_data.test[z]\n      let the_sum=model_results.intercept.coeff\n      for(let x=0;x<model_results.predictors.length;x++){\n        the_sum += model_results.predictors[x].coeff * parseFloat(test_row[x])\n      }  \n      const odds=Math.exp(the_sum)\n      let prediction = 0\n      const actual = parseInt(test_row[test_row.length-1])\n      if((odds/(odds+1))>.5){\n        prediction=1\n      }\n      confusion_array[actual][prediction]++\n    }\n    model_results.confusion=confusion_array\n  }\n  return model_results\n  \n  function Abs(x) { return Math.abs(x) }\n  function Sqrt(x) { return Math.sqrt(x) }\n  function Exp(x) { return Math.exp(x) }\n  function Ln(x) { return Math.log(x) }\n  function Power(x,n) { return Math.pow(x,n) }\n\n\n  function ChiSq(x,n) {\n      if(x>1000 | n>1000) { var q=Norm((Power(x/n,1/3)+2/(9*n)-1)/Sqrt(2/(9*n)))/2; if (x>n) {return q} else {return 1-q} }\n      var p=Math.exp(-0.5*x); if((n%2)==1) { p=p*Math.sqrt(2*x/Pi) }\n      var k=n; while(k>=2) { p=p*x/k; k=k-2 }\n      var t=p; var a=n; while(t>1e-15*p) { a=a+2; t=t*x/a; p=p+t }\n      return 1-p\n  }\n\n  function Norm(z) { var q=z*z\n      if(Abs(z)>7) {return (1-1/q+3/(q*q))*Exp(-q/2)/(Abs(z)*Sqrt(PiD2))} else {return ChiSq(q,1) }\n      }\n\n  function ANorm(p) { var v=0.5; var dv=0.5; var z=0\n    while(dv>1e-15) { z=1/v-1; dv=dv/2; if(Norm(z)>p) { v=v-dv } else { v=v+dv } }\n    return z\n    }\n\n  function Fmt(x) { var v;\n    if(x>=0) { v=\"          \"+(x+0.00005) } else { v=\"          \"+(x-0.00005) }\n    v = v.substring(0,v.indexOf(\".\")+5)\n    return v.substring(v.length-10,v.length)\n    }\n\n  function Fmt3(x) { var v;\n    v = \"   \" + x;\n    return v.substring(v.length-3,v.length)\n    }\n\n  function Fmt9(x) { var v;\n    v = \"         \" + x;\n    return v.substring(v.length-9,v.length)\n    }\n\n  function vFmt(x) { var v;\n    if(x>=0) { v=\"              \"+(x+0.0000005) } else { v=\"          \"+(x-0.0000005) }\n    v = v.substring(0,v.indexOf(\".\")+7)\n    return v.substring(v.length-14,v.length)\n    }\n\n  function Xlate(s,from,to) { var v = s;\n    var l=v.indexOf(from);\n    while(l>-1) {\n      v = v.substring(0,l) + to + v.substring(l+1,v.length);\n      l=v.indexOf(from)\n      }\n    return v\n      }\n\n  function crArr(n) {\n    this.length = n\n    for (var i = 0; i < this.length; i++) { this[i] = 0 }\n    }\n    \n  function ix(j,k,nCols) { return j * nCols + k }\n\n\n\n  function iterate() {\n\n    var i = 0; var j = 0; var k = 0; var l = 0;\n\n    var nC   = eval(form_data.cPts);\n    var nR   = eval(form_data.cVar);\n    var nP   = nR + 1;\n    var nP1  = nP + 1;\n    var sY0 = 0;\n    var sY1 = 0;\n    var sC = 0;\n    //console.log(\"confidence\", tag(\"confidence\").value)\n    var cConfLev = model_data.confidence//tag(\"confidence\").value\n    var zc = ANorm( 1 - eval(cConfLev)/100 )\n\n    var X    = new crArr( nC * ( nR + 1 ) );\n    var Y0   = new crArr( nC );\n    var Y1   = new crArr( nC );\n    var xM   = new crArr( nR + 1 );\n    var xSD  = new crArr( nR + 1 );\n    var Par  = new crArr( nP );\n    var SEP  = new crArr( nP );\n    var Arr  = new crArr( nP * nP1 );\n\n    var da = Xlate(form_data.data,Tb,\",\");\n  \n    form_data.data.value = da;\n    if( da.indexOf(NL)==-1 ) { if( da.indexOf(CR)>-1 ) { NL = CR } else { NL = LF } }\n\n    for (i = 0; i<nC; i++) {\n      X[ix(i,0,nR+1)] = 1;\n      l = da.indexOf(NL); if( l==-1 ) { l = da.length };\n      var v = da.substring(0,l);\n      da = da.substring(l+NL.length,da.length);\n      for (j = 1; j<=nR; j++) {\n        l = v.indexOf(\",\"); if( l==-1 ) { l = v.length };\n        x = eval(v.substring(0,l))\n        X[ix(i,j,nR+1)] = x;\n        v = v.substring(l+1,v.length);\n        }\n      if(false){\n        // grouped data instead of raw data.\n        l = v.indexOf(\",\"); if( l==-1 ) { l = v.length };\n        x = eval(v.substring(0,l))\n        Y0[i] = x; sY0 = sY0 + x;\n        v = v.substring(l+1,v.length);\n        l = v.indexOf(\",\"); if( l==-1 ) { l = v.length };\n        x = eval(v.substring(0,l))\n        Y1[i] = x; sY1 = sY1 + x;\n        v = v.substring(l+1,v.length);\n      }else{\n        x = eval(v.substring(0,l));\n        if ( x==0 ) { Y0[i] = 1; sY0 = sY0 + 1 } else { Y1[i] = 1; sY1 = sY1 + 1 }\n      }\n      sC = sC + (Y0[i] + Y1[i]);\n      for (j = 1; j<=nR; j++) {\n        x = X[ix(i,j,nR+1)];\n        xM[j] = xM[j] + (Y0[i] + Y1[i])*x;\n        xSD[j] = xSD[j] + (Y0[i] + Y1[i])*x*x;\n        }\n      }\n\n    var o = \"Descriptives...\" + NL;\n\n    o = o + ( NL + sY0 + \" cases have Y=0; \" + sY1 + \" cases have Y=1.\" + NL );\n\n    o = o + ( NL + \" Variable     Avg       SD    \" + NL );\n    for (j = 1; j<=nR; j++) {\n      xM[j]  = xM[j]  / sC;\n      xSD[j] = xSD[j] / sC;\n      xSD[j] = Sqrt( Abs( xSD[j] - xM[j] * xM[j] ) )\n      o = o + (  \"   \" + Fmt3(j) + \"    \" + Fmt(xM[j]) + Fmt(xSD[j])+ NL );\n      }\n    xM[0] = 0; xSD[0] = 1;\n\n    for (i = 0; i<nC; i++) {\n      for (j = 1; j<=nR; j++) {\n        X[ix(i,j,nR+1)] = ( X[ix(i,j,nR+1)] - xM[j] ) / xSD[j];\n        }\n      }\n\n    o = o + ( NL + \"Iteration History...\" );\n    //console.log(o);\n    form_data.output=o\n\n    Par[0] = Ln( sY1 / sY0 );\n    for (j = 1; j<=nR; j++) {\n      Par[j] = 0;\n      }\n\n    var LnV = 0; var Ln1mV = 0;\n\n    var LLp = 2e+10;\n    var LL  = 1e+10;\n    var Fract = 0.1\n\n    while( Abs(LLp-LL)>0.0000001 ) {\n      LLp = LL;\n      LL = 0;\n      for (j = 0; j<=nR; j++) {\n        for (k = j; k<=nR+1; k++) {\n          Arr[ix(j,k,nR+2)] = 0;\n          }\n        }\n      \n      for (i = 0; i<nC; i++) {\t\n        var v = Par[0];\n        for (j = 1; j<=nR; j++) {\n          v = v + Par[j] * X[ix(i,j,nR+1)];\n          }\n        if( v>15 ) { LnV = -Exp(-v); Ln1mV = -v; q = Exp(-v); v=Exp(LnV) }\n          else { if( v<-15 ) {\tLnV = v; Ln1mV = -Exp(v); q = Exp(v); v=Exp(LnV) }\n            else { v = 1 / ( 1 + Exp(-v) ); LnV = Ln(v); Ln1mV = Ln(1-v); q = v*(1-v) }\n          }\n        LL = LL - 2*Y1[i]*LnV - 2*Y0[i]*Ln1mV;\n        for (j = 0; j<=nR; j++) {\n          var xij = X[ix(i,j,nR+1)];\n          Arr[ix(j,nR+1,nR+2)] = Arr[ix(j,nR+1,nR+2)] + xij * ( Y1[i] * (1 - v) + Y0[i] * (-v) );\n          for (k=j; k<=nR; k++) {\n            Arr[ix(j,k,nR+2)] = Arr[ix(j,k,nR+2)] + xij * X[ix(i,k,nR+1)] * q * (Y0[i] + Y1[i]);\n            }\n          }\n        }\n\n      o = o + ( NL + \"-2 Log Likelihood = \" + Fmt( LL ) );\n      if( LLp==1e+10 ) { LLn = LL; o = o + \" (Null Model)\" }\n      //console.log(o);\n      form_data.output=o\n\n      for (j = 1; j<=nR; j++) {\n        for (k=0; k<j; k++) {\n          Arr[ix(j,k,nR+2)] = Arr[ix(k,j,nR+2)];\n          }\n        }\n\n      for (i=0; i<=nR; i++) { var s = Arr[ix(i,i,nR+2)]; Arr[ix(i,i,nR+2)] = 1;\n        for (k=0; k<=nR+1; k++) { Arr[ix(i,k,nR+2)] = Arr[ix(i,k,nR+2)] / s; }\n        for (j=0; j<=nR; j++) {\n          if (i!=j) { s = Arr[ix(j,i,nR+2)]; Arr[ix(j,i,nR+2)] = 0;\n            for (k=0; k<=nR+1; k++) {\n              Arr[ix(j,k,nR+2)] = Arr[ix(j,k,nR+2)] - s * Arr[ix(i,k,nR+2)];\n              }\n            }\n          }\n        }\n\n      for( j=0; j<=nR; j++) {\n        Par[j] = Par[j] + Fract * Arr[ix(j,nR+1,nR+2)];\n        }\n    Fract = Fract + 0.1; if( Fract>1 ) { Fract = 1 }\n      }\n\n    o = o + ( \" (Converged)\" + NL );\n    var CSq = LLn - LL;\n    o = o + ( NL + \"Overall Model Fit...\" + NL + \"  Chi Square=\" + Fmt(CSq) + \";  df=\" + nR + \";  p=\" + Fmt(ChiSq(CSq,nR)) + NL );\n    console.log(\"CSq,nR\",CSq,nR)\n    console.log(\"ChiSq(CSq,nR)\",ChiSq(CSq,nR))\n    model_results.fit={\n      chi_square:CSq,\n      df:nR,\n      p:ChiSq(CSq,nR)\n    }\n\n    o = o + ( NL + \"Coefficients, Standard Errors, Odds Ratios, and \" + cConfLev + \"% Confidence Limits...\" + NL );\n    o = o + ( \" Variable     Coeff.    StdErr       p          O.R.      Low  --  High\" + NL );\n    model_results.predictors=[]\n    for( j=1; j<=nR; j++) {\n      Par[j] = Par[j] / xSD[j];\n      SEP[j] = Sqrt( Arr[ix(j,j,nP+1)] ) / xSD[j];\n      Par[0] = Par[0] - Par[j] * xM[j];\n    //console.log(\"Fmt3(j)\",Fmt3(j))\n\n\n      o = o + ( \"   \" + Fmt3(j) + \"    \" + Fmt(Par[j]) + Fmt(SEP[j]) + Fmt( Norm(Abs(Par[j]/SEP[j])) ) );\n      var ORc = Exp( Par[j] );\n      var ORl = Exp( Par[j] - zc * SEP[j] );\n      var ORh = Exp( Par[j] + zc * SEP[j] );\n      o = o + ( \"   \" + Fmt(ORc) + Fmt(ORl) + Fmt(ORh) + NL );\n\n      model_results.predictors.push({\n        variable:form_data.predictor_names[form_data.predictors_in_model[Fmt3(j)-1]],\n        coeff:Par[j],\n        std_err:SEP[j],\n        p:Norm(Abs(Par[j]/SEP[j])),\n        odds_ratio:ORc,\n        conf_low:ORl,\n        conf_high:ORh\n        })\n      \n\n    }\n    SEI = 0;\n    for (j = 0; j<=nR; j++) {\n      if( j==0 ) { Xj = 1 } else { Xj = -xM[j]/xSD[j] }\n      for (k=0; k<=nR; k++) {\n        if( k==0 ) { Xk = 1 } else { Xk = -xM[k]/xSD[k] }\n        SEI = SEI + Xj * Xk * Arr[ix(j,k,nR+2)];\n        }\n      }\n    SEI = Sqrt( SEI )\n    o = o + ( \"Intercept \" + Fmt(Par[0]) + Fmt(SEI) + Fmt( Norm(Abs(Par[0]/SEI)) ) );\n    model_results.intercept={\n      coeff:Par[0],\n      std_err:SEI,\n      p:Norm(Abs(Par[0]/SEI)) \n    }\n    o = o + ( NL + NL + \"Predicted Probability of Outcome, with \" + cConfLev + \"% Confidence Limits...\" )\n    if(false)//grouped\n      { o = o + ( NL + \"    X                n0           n1     Prob        Low  --  High\" + NL ) }\n      else\n      { o = o + ( NL + \"    X                 Y     Prob        Low  --  High\" + NL ) }\n    for (i = 0; i<nC; i++) {\t\n      v = Par[0];\n      for (j = 1; j<=nR; j++) {\n        x = xM[j] + xSD[j] * X[ix(i,j,nR+1)];\n        v = v + Par[j] * x;\n        o = o + Fmt(x);\n        }\n      p = 1 / ( 1 + Exp( -v ) );\n      if(false)//grouped\n        { o = o + ( \"    \" + Fmt9(Y0[i]) + \"    \" + Fmt9(Y1[i]) + Fmt(p) ) }\n        else\n        { o = o + ( \"    \" + Fmt9(Y1[i]) + Fmt(p) ) }\n\n    SEY = 0;\n    for (j = 0; j<=nR; j++) {\n      if( j==0 ) { Xj = 1 } else { Xj = X[ix(i,j,nR+1)] }\n      for (k=0; k<=nR; k++) {\n        if( k==0 ) { Xk = 1 } else { Xk = X[ix(i,k,nR+1)] }\n        SEY = SEY + Xj * Xk * Arr[ix(j,k,nR+2)];\n        }\n      }\n    SEY = Sqrt( SEY )\n    o = o + ( \" \" + Fmt(1/(1+Exp(-(v-zc*SEY)))) + \" \" + Fmt(1/(1+Exp(-(v+zc*SEY)))) );\n    o = o + NL;\n    }\n    //console.log(o);\n    form_data.output=o\n    model_results.text=o\n  }\t\t\n}"
    },
    "logistic-regression.html": {
      "filename": "logistic-regression.html",
      "type": "text/html",
      "language": "HTML",
      "raw_url": "https://gist.githubusercontent.com/jade-addin/9382a0ae7967eef62acf20f0f31a8c31/raw/43e3708dfc37505273ea23dcab53cbcd6ae5dc43/logistic-regression.html",
      "size": 10137,
      "truncated": false,
      "content": "\n<div class=\"hidden\" id=\"jet-refresh\" style=\"margin-left: .5rem;\"><i title=\"Re-load this tool.\" onclick=\"jade_modules.jet_engine.select_page()\" class=\"fa-solid fa-arrows-rotate\"  cursor:pointer\"></i></div>    \n<div style=\"margin:1rem; text-align: center;\"><div style=\"display:inline-block; text-align: left;\">\n    <table style=\"width:100%\" align=\"center\" cellspacing=\"0\" cellpadding=\"4\">\n        <tbody>\n            <tr>\n                <td onclick=\"jade_modules.jet_engine.toggle_table(this.nextElementSibling.firstElementChild)\" colspan=\"2\" class=\"section head\">Example</td>\n                <td class=\"section drop\"><i  title=\"Hide or show this step.\" onclick=\"jade_modules.jet_engine.toggle_table(this)\" class=\"fa-solid fa-chevron-down\"></i></td>\n            </tr>            \n            <tr class=\"hidden\" style=\"background-color: white;\">\n                <td colspan=\"3\">Click the button below to build a sheet called \"Example Data\" and configure this tool to run an analysis based on the data.  You can <a href=\"https://vimeo.com/manage/videos/735466668\">watch a video</a> walking you through the process and explaining the basics of the analysis.</td>\n            </tr>            \n            <tr class=\"hidden\">\n                <td colspan=\"3\" align=\"right\"><button id=\"configure-button\" onclick=\"jade_modules.code.configure_example()\">Configure Example</button></td>\n            </tr>            \n        </tbody>\n    </table>\n    <div style=\"margin-top: 1rem;\" />\n\n    <table style=\"width:100%\" align=\"center\" cellspacing=\"0\" cellpadding=\"4\">\n        <tbody>\n            <tr>\n                <td onclick=\"jade_modules.jet_engine.toggle_next_row(this)\" colspan=\"2\" class=\"section head\">1. Identify Data</td>\n                <td class=\"section drop\"><i  title=\"Hide or show this step.\" onclick=\"jade_modules.jet_engine.toggle_table(this)\" class=\"fa-solid fa-chevron-up\"></i></td>\n            </tr>            \n            <tr class=\"hidden note\">\n                <td colspan=\"3\">In this step, you will add a column to your data to indicate which rows should be used for building the model and which should be used for validating the model.</td>\n            </tr>            \n            <tr>\n                <td onclick=\"jade_modules.jet_engine.toggle_next_row(this)\"  class=\"label\" >Data Sheet:</td>\n                <td class=\"entry\"><input type=\"text\" id=\"datasheet\" onchange=\"jade_modules.code.new_data_sheet()\" onfocus=\"jade_modules.jet_engine.default_selected_sheet(this)\"/></td>\n                <td><i title=\"Get the name of the active sheet.\" onclick=\"jade_modules.jet_engine.get_sheet_name('datasheet');jade_modules.code.new_data_sheet()\" class=\"fa-solid fa-file\" style=\"color:#777; cursor:pointer\"></i></td>\n            </tr>            \n            <tr class=\"hidden note\">\n                <td colspan=\"3\">This is the name of the worksheet that has the data you will use to build your prediction model</td>\n            </tr>            \n            <tr>\n                <td onclick=\"jade_modules.jet_engine.toggle_next_row(this)\"  class=\"label\" >Data Range:</td>\n                <td class=\"entry\"><input type=\"text\" id=\"datarange\" onchange=\"jade_modules.code.new_data_range()\"  onfocus=\"jade_modules.jet_engine.default_selected_range(this)\"/></td>\n                <td><i title=\"Get the data columns from the selecte range.\" onclick=\"jade_modules.jet_engine.get_multicell_address('datarange');jade_modules.code.new_data_range()\" class=\"fa-solid fa-table\" style=\"color:#777; cursor:pointer\"></i></td>\n            </tr>            \n            <tr class=\"hidden note\">\n                <td colspan=\"3\">This is the column that holds all of your data, including both dependent variables and independent variables.</td>\n            </tr>                \n            <tr onclick=\"jade_modules.jet_engine.toggle_next_row(this)\" class=\"label\" >\n                <td  onclick=\"jade_modules.jet_engine.toggle_next_row(this)\" class=\"label\" >Training Set %:</td>\n                <td class=\"entry\"><input type=\"text\" id=\"training-percent\" value=\"80\"/></td>\n                <td></td>\n            </tr>            \n            <tr class=\"hidden note\">\n                <td colspan=\"3\">This is the percent of your data you want to use to train the model.  It is number like 80.  Set this to 100 to build a model without also testing it.</td>\n            </tr>            \n    \n            <tr>\n                <td colspan=\"3\" align=\"right\"><button id=\"configure-button\" onclick=\"jade_modules.code.split_data()\">Split Data</button></td>\n            </tr>            \n        </tbody>\n    </table>\n    <div style=\"margin-top: 1rem;\" />\n        \n\n    <table style=\"width:100%\" align=\"center\" cellspacing=\"0\" cellpadding=\"4\">\n    <tbody>\n        <tr>\n            <td onclick=\"jade_modules.jet_engine.toggle_next_row(this)\" colspan=\"2\" class=\"section head\">2. Configure Model</td>\n            <td class=\"section drop\"><i  title=\"Hide or show this step.\" onclick=\"jade_modules.jet_engine.toggle_table(this)\" class=\"fa-solid fa-chevron-up\"></i></td>\n        </tr>            \n        <tr class=\"hidden note\">\n            <td colspan=\"3\">In this step, you configure this tool to indicate how the model should be run.</td>\n        </tr>            \n        <!--tr>\n            <td onclick=\"jade_modules.jet_engine.toggle_next_row(this)\"  class=\"label\" >Confidence Level:</td>\n            <td><input size=\"2\" type=\"text\" id=\"confidence\" value=\"95\"/>%</td>\n            <td></td>\n        </tr>            \n        <tr class=\"hidden note\">\n            <td colspan=\"3\">Confidence level is used for determining the upper and lower boundaries of the confidence interval in the analysis report.  It's usually a number fairly close to 100%, like 90%, 95% or 99%.</td>\n        </tr-->            \n        <tr>\n            <td onclick=\"jade_modules.jet_engine.toggle_next_row(this)\"  class=\"label\" >Outcome:</td>\n            <td class=\"entry\"><input type=\"text\" id=\"outcome\" onchange=\"jade_modules.code.reset_model()\" onfocus=\"jade_modules.jet_engine.default_selected_range(this);jade_modules.code.reset_model()\"/></td>\n            <td><i title=\"Get the data columns from the selecte range.\" onclick=\"jade_modules.jet_engine.get_data_column_address('outcome');jade_modules.code.reset_model()\" class=\"fa-solid fa-table\" style=\"color:#777; cursor:pointer\"></i></td>\n        </tr>            \n        <tr class=\"hidden note\">\n            <td colspan=\"3\">The range that holds the model outcome data.  This is also known as the \"dependent variables,\" \"response\" or the \"label\".</td>\n        </tr>            \n        <tr>\n            <td onclick=\"jade_modules.jet_engine.toggle_next_row(this)\"  class=\"label\" >Predictors:</td>\n            <td class=\"entry\"><input type=\"text\" id=\"predictors\"  onchange=\"jade_modules.code.reset_model()\" onfocus=\"jade_modules.jet_engine.default_selected_range(this);jade_modules.code.reset_model()\"/></td>\n            <td><i title=\"Get the data columns from the selected range.\" onclick=\"jade_modules.jet_engine.get_data_column_address('predictors');jade_modules.code.reset_model()\" class=\"fa-solid fa-table\" style=\"color:#777; cursor:pointer\"></i></td>\n        </tr>            \n        <tr class=\"hidden note\">\n            <td colspan=\"3\">The range that holds the model input data. These are also know as \"independent variables\" or \"features\".</td>\n        </tr>            \n        <tr>\n            <td id=\"predictor-names\" colspan=\"3\" style=\"padding-left: 1rem;\"></td>\n        </tr>      \n        <tr>\n            <td colspan=\"3\" align=\"right\"><button id=\"configure-button\" onclick=\"jade_modules.code.run_model()\">Run Model</button></td>\n        </tr>            \n    </tbody>\n</table>\n<div style=\"margin-top: 1rem;\" />\n\n<table style=\"width:100%\" align=\"center\" cellspacing=\"0\" cellpadding=\"4\">\n    <tbody>\n        <tr>\n            <td onclick=\"jade_modules.jet_engine.toggle_next_row(this)\" colspan=\"2\" class=\"section head\">3. Make Predictions</td>\n            <td class=\"section drop\"><i  title=\"Hide or show this step.\" onclick=\"jade_modules.jet_engine.toggle_table(this)\" class=\"fa-solid fa-chevron-up\"></i></td>\n        </tr>            \n        <tr class=\"hidden note\">\n            <td colspan=\"3\">This step will add three columns (odds, probability, and prediction) to a table that has the same predctors as the table used to create the most recently-run model.</td>\n        </tr>            \n        <tr>\n            <td onclick=\"jade_modules.jet_engine.toggle_next_row(this)\"  class=\"label\" >Data Sheet:</td>\n            <td class=\"entry\"><input type=\"text\" id=\"predictionsheet\" onfocus=\"jade_modules.jet_engine.default_selected_sheet(this)\"/></td>\n            <td><i title=\"Get the name of the active sheet.\" onclick=\"jade_modules.jet_engine.get_sheet_name('predictionsheet')\" class=\"fa-solid fa-file\" style=\"color:#777; cursor:pointer\"></i></td>\n        </tr>            \n        <tr class=\"hidden note\">\n            <td colspan=\"3\">This is the name of the worksheet that has the data about which you want predictions.  Include a row at the top with column names.  The data must have column names that match the column names of the predictors used to create the model.</td>\n        </tr>            \n        <tr>\n            <td onclick=\"jade_modules.jet_engine.toggle_next_row(this)\"  class=\"label\" >Data Range:</td>\n            <td class=\"entry\"><input type=\"text\" id=\"predictionrange\" onfocus=\"jade_modules.jet_engine.default_selected_range(this)\"/></td>\n            <td><i title=\"Get the address of the selected range.\" onclick=\"jade_modules.jet_engine.get_multicell_address('predictionrange')\" class=\"fa-solid fa-table\" style=\"color:#777; cursor:pointer\"></i></td>\n        </tr>            \n        <tr class=\"hidden note\">\n            <td colspan=\"3\">This is a reference to table of data with your predictions, including a header row.</td>\n        </tr>            \n        <tr>\n            <td colspan=\"3\" align=\"right\"><button onclick=\"jade_modules.code.predict()\">Predict Outcomes</button></td>\n        </tr>            \n    </tbody>\n</table>\n</div></div>\n<input  type=\"hidden\" id=\"confidence\" value=\"95\"/>"
    },
    "manifest.json": {
      "filename": "manifest.json",
      "type": "application/json",
      "language": "JSON",
      "raw_url": "https://gist.githubusercontent.com/jade-addin/9382a0ae7967eef62acf20f0f31a8c31/raw/3d2cd53138c7fce67102091f00cd9fbc8c69f4aa/manifest.json",
      "size": 58,
      "truncated": false,
      "content": "[\r\n    \"code.js\",\"logistic-regression.html\",\"style.css\"\r\n]"
    },
    "style.css": {
      "filename": "style.css",
      "type": "text/css",
      "language": "CSS",
      "raw_url": "https://gist.githubusercontent.com/jade-addin/9382a0ae7967eef62acf20f0f31a8c31/raw/ae9d67dd384f76ed854e64dea58b7fb13afee165/style.css",
      "size": 6,
      "truncated": false,
      "content": "/**/\r\n"
    }
  },
  "public": true,
  "created_at": "2022-05-06T11:55:30Z",
  "updated_at": "2022-08-01T15:13:09Z",
  "description": "JET: Logistic Regression tool for the JADE Excel Add-in (using javascript)",
  "comments": 0,
  "user": null,
  "comments_url": "https://api.github.com/gists/9382a0ae7967eef62acf20f0f31a8c31/comments",
  "owner": {
    "login": "jade-addin",
    "id": 97227368,
    "node_id": "U_kgDOBcuSaA",
    "avatar_url": "https://avatars.githubusercontent.com/u/97227368?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jade-addin",
    "html_url": "https://github.com/jade-addin",
    "followers_url": "https://api.github.com/users/jade-addin/followers",
    "following_url": "https://api.github.com/users/jade-addin/following{/other_user}",
    "gists_url": "https://api.github.com/users/jade-addin/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jade-addin/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jade-addin/subscriptions",
    "organizations_url": "https://api.github.com/users/jade-addin/orgs",
    "repos_url": "https://api.github.com/users/jade-addin/repos",
    "events_url": "https://api.github.com/users/jade-addin/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jade-addin/received_events",
    "type": "User",
    "site_admin": false
  },
  "forks": [

  ],
  "history": [
    {
      "user": {
        "login": "theGove",
        "id": 24496385,
        "node_id": "MDQ6VXNlcjI0NDk2Mzg1",
        "avatar_url": "https://avatars.githubusercontent.com/u/24496385?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theGove",
        "html_url": "https://github.com/theGove",
        "followers_url": "https://api.github.com/users/theGove/followers",
        "following_url": "https://api.github.com/users/theGove/following{/other_user}",
        "gists_url": "https://api.github.com/users/theGove/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/theGove/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/theGove/subscriptions",
        "organizations_url": "https://api.github.com/users/theGove/orgs",
        "repos_url": "https://api.github.com/users/theGove/repos",
        "events_url": "https://api.github.com/users/theGove/events{/privacy}",
        "received_events_url": "https://api.github.com/users/theGove/received_events",
        "type": "User",
        "site_admin": false
      },
      "version": "956c63dc31e222b26a5dcd1a05b4e8edc5b6ecce",
      "committed_at": "2022-08-01T15:13:07Z",
      "change_status": {
        "total": 1100,
        "additions": 1100,
        "deletions": 0
      },
      "url": "https://api.github.com/gists/9382a0ae7967eef62acf20f0f31a8c31/956c63dc31e222b26a5dcd1a05b4e8edc5b6ecce"
    }
  ],
  "truncated": false
}
